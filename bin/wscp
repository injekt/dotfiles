#!/usr/bin/env ruby

require "securerandom"

path = ARGF.read.to_s.chomp
exit unless path.size > 0
exit unless File.file?(path)

filename = File.basename(path)

unless filename.start_with?("Screen Shot ")
  exit
end

# new_filename = Time.new.strftime("%Y%m%d%H%M%S") + ".png"
new_filename = SecureRandom.urlsafe_base64(4) + ".png"
remote       = "http://jarvo.io/s/#{new_filename}"

system("scp", path, "jarvo.io:s/#{new_filename}")

p [path, remote]

`echo "#{remote}" | pbcopy`
`osascript -e 'Display notification "Uploaded #{remote}" with title "Screenshot"'`
`afplay "/System/Library/Sounds/Glass.aiff"`

File.unlink(path)
