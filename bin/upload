#!/usr/bin/env ruby

require "securerandom"

if ARGV.size != 1
  abort "upload <filename>"
end

path = ARGV[0]

unless File.file?(path)
  abort "No such file at `#{path}'"
end

def decide_filename(path, shorten: false)
  name = File.basename(path)
  ext  = File.extname(path)

  if shorten
    SecureRandom.urlsafe_base64(6) + ext
  elsif name.start_with?("Screen Shot")
    name.scan(/\d+/).join("") + ext
  else
    name.gsub(/\s+/, "_")
  end
end

filename = decide_filename(path)
newpath  = "public/u/#{filename}"
url      = "https://leejarvis.me/u/#{filename}"

`echo "#{url}" | pbcopy`
`scp "#{path}" jarvo:#{newpath}`
puts url
